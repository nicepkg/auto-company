# Cycle 005 Supabase Persistence Fast Path (Dashboard-Only Apply)

Goal: complete the current Next Action with the fewest moving parts:
1) apply schema + seed via Supabase Dashboard SQL Editor bundle
2) ensure hosted runtime has `NEXT_PUBLIC_SUPABASE_URL` + `SUPABASE_SERVICE_ROLE_KEY`
3) run one customer-originated hosted intake
4) capture DB persistence evidence (`workflow_runs` + `workflow_events`) and attach it to sales ledger

## 1) Apply Migration + Seed (Dashboard SQL Editor)

Paste and run this bundle in Supabase Dashboard -> SQL Editor:
- `projects/security-questionnaire-autopilot/supabase/bundles/20260213_cycle003_hosted_workflow_migration_plus_seed.sql`

The bundle ends with `VERIFY` queries. Expected:
- tables: `workflow_runs`, `workflow_events`, `pilot_deals`
- seed row: `workflow_runs.run_id = 'pilot-001-live-2026-02-13'`

## 2) Hosted Runtime Env Vars (No Secrets in Repo)

Set these in the hosted Next.js runtime (Vercel/Render/etc), server-side:
- `NEXT_PUBLIC_SUPABASE_URL` (Supabase project URL)
- `SUPABASE_SERVICE_ROLE_KEY` (service role key)

Pattern: store them in the hosting providerâ€™s encrypted environment config, scoped to the production project, not in `.env` committed to git.

## 3) Run One Hosted Customer Intake + Capture Evidence

From any machine with network access to the deployed app:

```bash
cd projects/security-questionnaire-autopilot

BASE_URL="https://<your-hosted-nextjs-base-url>"
RUN_ID="pilot-001-customer-originated-db-$(date +%Y%m%d-%H%M%S)"

./scripts/hosted-workflow-customer-intake.sh "$BASE_URL" "$RUN_ID" "/tmp/hosted-intake-$RUN_ID"
```

Evidence files (generated by the script):
- `/tmp/hosted-intake-$RUN_ID/responses/06-db-evidence.json` (raw)
- `/tmp/hosted-intake-$RUN_ID/responses/06-db-evidence.json.pretty` (human-readable)

Pass condition: evidence JSON includes:
- `workflowRun.run_id == <RUN_ID>`
- `workflowEvents` includes `ingest`, `draft`, `approve`, `export` with `status='success'`

## 4) Attach Evidence To Sales Ledger

Attach the `.pretty` evidence JSON (and optionally direct PostgREST evidence JSON) into:
- `docs/sales/cycle-003-hosted-workflow-pilot-001-execution.md`

